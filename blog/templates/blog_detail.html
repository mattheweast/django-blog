{% extends 'base.html' %}  
{% block page_content %}  
    <article class="post-card">
        <h1>{{ post.title }}</h1>
        <div class="post-meta">
            Posted on {{ post.created_on|date:"F d, Y" }}
            {% if post.categories.all %}
                in
                {% for category in post.categories.all %}
                    <a href="{% url 'blog_category' category=category.name %}">{{ category.name }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}
            {% endif %}
        </div>
        <div class="post-content">
            {{ post.body|linebreaks }}
        </div>
    </article>
    
    <section class="comment-section">
        <h3>Comments ({{ comments|length }})</h3>
        
        {% for comment in comments %}
            <div class="comment">
                <div class="comment-author">
                    {% if comment.user %}{{ comment.user.username }}{% else %}{{ comment.author }}{% endif %}
                    <span class="comment-date">{{ comment.created_on|date:"F d, Y g:i A" }}</span>
                </div>
                <div class="comment-body">
                    {{ comment.body|linebreaks }}
                </div>
            </div>
        {% empty %}  
            <p class="empty-state">No comments yet. Be the first to comment!</p>  
        {% endfor %}
        
        {% if user.is_authenticated %}
            <div class="comment-form">
                <h3>Leave a Comment</h3>  
                <form method="post">  
                    {% csrf_token %}  
                    {{ form.body }}  
                    <button type="submit" class="btn btn-primary">Post Comment</button>  
                </form>
            </div>
        {% else %}
            <div class="empty-state">
                <p>ðŸ’¬ <a href="{% url 'login' %}?next={{ request.path }}">Login</a> or <a href="{% url 'register' %}?next={{ request.path }}">register</a> to leave a comment.</p>
            </div>
        {% endif %}
    </section>
{% endblock %}
